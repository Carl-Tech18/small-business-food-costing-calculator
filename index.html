<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Food Costing Calculator v2.2</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Food Costing Calculator v2.2</h1>

    <section class="dish-meta">
      <label>Date: <input type="date" id="dishDate" /></label>
      <label>Dish Name: <input type="text" id="dishName" /></label>
      <label>Upload Dish Photo: <input type="file" id="dishPhoto" accept="image/*" /></label>
      <div id="photoPreview"></div>
    </section>

    <!-- Ingredients Table -->
    <section>
      <h3>Ingredients</h3>
      <table>
        <thead>
          <tr>
            <th>Ingredient</th>
            <th>Unit</th>
            <th>Unit Cost</th>
            <th>Qty</th>
            <th>Converted Qty</th>
            <th>Total Cost</th>
          </tr>
        </thead>
        <tbody id="ingredientsBody"></tbody>
      </table>
      <button onclick="addIngredientRow()">Add Ingredient</button>
    </section>

    <!-- Sub-Recipes Table -->
    <section>
      <h3>Sub-Recipes</h3>
      <table>
        <thead>
          <tr>
            <th>Sub-Recipe</th>
            <th>Unit</th>
            <th>Unit Cost</th>
            <th>Qty</th>
            <th>Total Cost</th>
          </tr>
        </thead>
        <tbody id="subRecipesBody"></tbody>
      </table>
      <button onclick="addSubRecipeRow()">Add Sub-Recipe</button>
    </section>

    <!-- Overhead Costs -->
    <section>
      <h3>Overhead & Yield</h3>
      <label>Labor Cost: <input type="number" id="laborCost" /></label>
      <label>Utilities Cost: <input type="number" id="utilitiesCost" /></label>
      <label>Packaging Cost: <input type="number" id="packagingCost" /></label>
      <label>Yield (Portions): <input type="number" id="yieldCount" /></label>
      <label>Profit Per Portion: <input type="number" id="profitPerPortion" /></label>
      <label>Batch Scale: <input type="number" id="batchScale" value="1" onchange="applyBatchScaling()" /></label>
    </section>

    <section class="pricing">
      <label>Estimated Sale Price: <input type="number" id="estSalePrice" /></label>
      <label>Target Margin (%): <input type="number" id="targetMargin" value="60" /></label>
      <p>Auto-Suggested Price: <span id="autoSuggest">₱0.00</span></p>
    </section>

    <section class="results">
      <p>Total Cost: ₱<span id="totalCost">0.00</span></p>
      <p>Cost Margin: <span id="costMargin">0%</span></p>
      <p>Net Profit: ₱<span id="netProfit">0.00</span></p>
      <p>VAT (12%): ₱<span id="vatAmount">0.00</span></p>
      <p>Price excl. VAT: ₱<span id="vatExcluded">0.00</span></p>
      <p>Discount (20%): ₱<span id="discountValue">0.00</span></p>
      <p>Discounted Price: ₱<span id="discountedPrice">0.00</span></p>
      <p>Profit After Discount: ₱<span id="profitAfterDiscount">0.00</span></p>
      <p>Profit Difference: ₱<span id="profitDifference">0.00</span></p>
    </section>

    <section class="chart-section">
      <canvas id="pieChart" width="300" height="300"></canvas>
    </section>

    <div class="buttons">
      <button onclick="resetAll()">Reset All</button>
      <button onclick="saveToLocal()">Save</button>
      <button onclick="loadFromLocal()">Load</button>
      <button onclick="exportPDF()">Export to PDF</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
